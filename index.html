<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
<script>
    // Firebase configuration (replace with your actual config)
    const firebaseConfig = {
  apiKey: "AIzaSyB3ympyd2TkzEA8F35a9DfZ0Ahz5lXDkfg",
  authDomain: "aru-research-71765.firebaseapp.com",
  projectId: "aru-research-71765",
  storageBucket: "aru-research-71765.firebasestorage.app",
  messagingSenderId: "112268583297",
  appId: "1:112268583297:web:2da01fd02baf4fd4898880",
  measurementId: "G-PK5YEPLV7Q"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Database Collections
    const DB_COLLECTIONS = {
        EMPLOYEES: "employees",
        PROJECTS: "projects",
        SETTINGS: "settings"
    };

    // Initialize data
    let employees = [];
    let projects = [];
    let adminPassword = "Admin1234";
    let loggedInUser = null;

    // Salary Slabs (example rates)
    const slabRates = {
        "A": 100,
        "B": 80,
        "C": 60
    };

    // Load all data from Firestore
    async function loadAllData() {
        try {
            // Load employees
            const employeesSnapshot = await db.collection(DB_COLLECTIONS.EMPLOYEES).get();
            employees = employeesSnapshot.docs.map(doc => doc.data());
            
            // Load projects
            const projectsSnapshot = await db.collection(DB_COLLECTIONS.PROJECTS).get();
            projects = projectsSnapshot.docs.map(doc => doc.data());
            
            // Load admin password
            const settingsDoc = await db.collection(DB_COLLECTIONS.SETTINGS).doc("admin").get();
            if (settingsDoc.exists) {
                adminPassword = settingsDoc.data().password || "Admin1234";
            } else {
                // Initialize admin password if not exists
                await db.collection(DB_COLLECTIONS.SETTINGS).doc("admin").set({
                    password: adminPassword
                });
            }
            
            // Refresh views
            loadProjectList();
            loadSalaryDashboard();
            
            return true;
        } catch (error) {
            console.error("Error loading data:", error);
            showErrorMessage("taskErrorMessage", "Error loading data. Please refresh the page.");
            return false;
        }
    }

    // Save employee data
    async function saveEmployee(employeeData) {
        try {
            const docId = `${employeeData.name}_${employeeData.date}`;
            await db.collection(DB_COLLECTIONS.EMPLOYEES).doc(docId).set(employeeData, { merge: true });
            return true;
        } catch (error) {
            console.error("Error saving employee:", error);
            return false;
        }
    }

    // Save project data
    async function saveProject(projectData) {
        try {
            const docId = projectData.name.toLowerCase().replace(/\s+/g, '_');
            await db.collection(DB_COLLECTIONS.PROJECTS).doc(docId).set(projectData);
            return true;
        } catch (error) {
            console.error("Error saving project:", error);
            return false;
        }
    }

    // Update admin password
    async function updateAdminPassword(newPassword) {
        try {
            await db.collection(DB_COLLECTIONS.SETTINGS).doc("admin").set({
                password: newPassword
            });
            adminPassword = newPassword;
            return true;
        } catch (error) {
            console.error("Error updating password:", error);
            return false;
        }
    }

    // [Rest of your existing functions remain the same, but replace localStorage operations with Firestore calls]
    // For example, replace saveData(DB_KEYS.EMPLOYEES, employees) with saveEmployee(employeeData)

    // Initialize the page
    document.addEventListener("DOMContentLoaded", function() {
        loadAllData();
        showPortal('taskUpdate');
    });
</script>